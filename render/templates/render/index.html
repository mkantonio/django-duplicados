<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Duplicados</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous"/>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.5/css/jquery.dataTables.min.css"/>
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.0/css/buttons.dataTables.min.css"/>


</head>
<body>
<main class="container">
    <div class="row text-center justify-content-center">
        <div class="col">
            <h1 class="display-4">Eliminar duplicados</h1>
        </div>
    </div>

    <form id="form" method="post">
        <div class="row">
            <div class="col-6">
                <div class="mb-3">
                    <label for="exampleFormControlTextarea1" id="label1" class="form-label">Columna 1</label>
                    <textarea class="form-control" id="exampleFormControlTextarea1" name="ntextarea1" rows="15"></textarea>
                </div>
                <button class="btn btn-primary" type="submit">Realizar comparacion</button>

            </div>
            <div class="col-6">
                <div class="mb-3">
                    <label for="exampleFormControlTextarea2" id="label2" class="form-label">Columna 2</label>
                    <textarea class="form-control" id="exampleFormControlTextarea2" name="ntextarea2" rows="15"></textarea>
                </div>
                <button class="btn btn-danger" type="button" id="btn-limpiar">Limpiar campos</button>

            </div>
        </div>
    </form>
    <br>
    <div class="row">
        <table id="example" class="display nowrap" style="width:100%">
            <thead>
                <tr>
                    <th>Nro Fila</th>
                    <th>Codigo</th>
                </tr>
            </thead>
            <tbody>
                <td>Tiger Nixon</td>
                <td>System Architect</td>
            </tbody>
            <tfoot>
                <tr>
                    <th>Nro Fila</th>
                    <th>Codigo</th>
                </tr>
            </tfoot>
        </table>  

    </div>
</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>


<script src="https://code.jquery.com/jquery-3.5.1.js"></script>
<script src="https://cdn.datatables.net/1.13.5/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.0/js/dataTables.buttons.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.0/js/buttons.html5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.0/js/buttons.print.min.js"></script>


</body>
<script type="text/javascript">

document.addEventListener('DOMContentLoaded', function() {

    $('#example').DataTable({
        dom: 'Bfrtip',
        buttons: [
            {
                extend: 'excel',
                filename: `duplicados-${timestamp()}`
            },
            'copy',
            {
                extend: 'csv',
                filename: `duplicados-${timestamp()}`
            },
            'pdf',
        ],
        language: {
            search: "Buscar:",
            lengthMenu: "Mostrar _MENU_ entradas",
            info: "Mostrando _START_ a _END_ de _TOTAL_ entradas",
            infoEmpty: "Mostrando 0 a 0 de 0 entradas",
            infoFiltered: "(filtrado de _MAX_ entradas totales)",
            zeroRecords: "No se encontraron resultados",
            paginate: {
            first: "Primero",
            last: "Último",
            next: "Siguiente",
            previous: "Anterior"
            }
        }
    });

    function timestamp(){
        const now = new Date();
        const formattedDate = `${now.getFullYear()}-${(now.getMonth() + 1).toString().padStart(2, '0')}-${now.getDate().toString().padStart(2, '0')}_${now.getHours().toString().padStart(2, '0')}-${now.getMinutes().toString().padStart(2, '0')}-${now.getSeconds().toString().padStart(2, '0')}`;
        return formattedDate;
     }

    /*
    function countLines(textarea) {
        let lines = textarea.value.split('\n');
        let lineCount = lines.length;
        for (let i = 0; i < lines.length; i++) {
            if (lines[i].length === 0) {
                lineCount--;
            }
        }
        return lineCount;
    }

    let textarea = document.getElementById('exampleFormControlTextarea1');
    let label = document.getElementById('label1');
    textarea.addEventListener('input', function(e) {
        if (e.inputType === 'insertFromPaste') {

            let lineCount = countLines(textarea);
            label.innerHTML = 'Líneas: ' + lineCount;
        }
    });
    */

    let textarea = document.getElementById('exampleFormControlTextarea1');
    let textarea2 = document.getElementById('exampleFormControlTextarea2');
    textarea.value= `45CFC2183986278B830FDBE5223A998BEA71E702E39399EC57A6AFD74
45CFC2183986278B82E4D7A3BA1D2A7A48D0E57C419399EC57A6AFD74
45CFC2183986278B81E8F8E92ADA076E2392E3F5A99399EC57A6AFD74
45CFC2183986278B80712016D1C8DBF66ED3E26F039399EC57A6AFD74
45CFC2183986278B7EEF5CA6715981C1F6F7E0E8609399EC57A6AFD74
45CFC2183986278B7C56920786AA564B82E8DF61C29399EC57A6AFD74
45CFC2183986278B7C39921559C333CC9379DDDB209399EC57A6AFD74
45CFC2183986278B7A500A90F4F7B24EACEBDC54879399EC57A6AFD74
45CFC2183986278B7996D56694BB946501A4DACDE19399EC57A6AFD74
45CFC2183986278B727B5DA6F29EDFEC17CAD947429399EC57A6AFD74
45CFC2183986278B6D0FFA2641F6BC09028AD7C0A49399EC57A6AFD74
45CFC2183986278B69725F29FB5865BD0C6DD63A089399EC57A6AFD74`;

textarea2.value= `45CFC2183986278B830FDBE5223A998BEA71E702E39399EC57A6AFD74
45CFC2183986278B82E4D7A3BA1D2A7A48D0E57C419399EC57A6AFD74
45CFC2183986278B81E8F8E92ADA076E2392E3F5A99399EC57A6AFD74
45CFC2183986278B80712016D1C8DBF66ED3E26F039399EC57A6AFD74
45CFC2183986278B7EEF5CA6715981C1F6F7E0E8609399EC57A6AFD74
45CFC2183986278B7C56920786AA564B82E8DF61C29399EC57A6AFD74
45CFC2183986278B7C39921559C333CC9379DDDB209399EC57A6AFD74
45CFC2183986278B7A500A90F4F7B24EACEBDC54879399EC57A6AFD74
45CFC2183986278B7996D56694BB946501A4DACDE19399EC57A6AFD74`;

    let label = document.getElementById('label1');
    let label2 = document.getElementById('label2');

    function countLines(textareap) {
        let lines = textareap.value.split('\n');
        let lineCount = lines.length;
        for (let i = 0; i < lines.length; i++) {
            if (lines[i].length === 0) {
                lineCount--;
            }
        }
        return lineCount;
    }

    textarea.addEventListener('input', function() {
        let lineCount = countLines(this);
        label.innerHTML = `Columna 1 - Líneas: ${lineCount}`;
    });

    textarea2.addEventListener('input', function() {
        let lineCount = countLines(this);
        label2.innerHTML = `Columna 2 - Líneas: ${lineCount}`;
    });



    const form = document.getElementById('form');
    form.addEventListener('submit', (event) => {
        event.preventDefault();
        const formulario = new FormData(form);
        fetch('{% url "post_request" %}', {
            method: 'POST',
            body: formulario
        })
        .then(response => {
            // console.log(response);
            if (!response.ok){
                throw new Error(`Error HTTP: ${response.status}`);    
            }
            return response.json();
        })
        .then(respuesta => {
            console.log(respuesta);
            let resp = respuesta["result"];
            console.log(resp);

            const arr = Object.keys(resp).map(key => ({ key, value: resp[key] }));

            console.log(arr);         


            const table = $('#example').DataTable();

            table.clear();

            

            table.draw();

            // $('#example').DataTable({
            //     data: Object.entries(resp).map(([key, value]) => ({ key, value })),
            //     columns: [
            //         { title: "Llave", data: "key" },
            //         { title: "Valor", data: "value" }
            //     ]
            // });



        })
        .catch(error => console.log(error));
    });


    let btnLimpiar = document.querySelector("#btn-limpiar");
    btnLimpiar.addEventListener('click', function() {
        textarea.value="";
        textarea2.value="";
    });
    

});
</script>
</html>